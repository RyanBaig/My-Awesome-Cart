{% extends 'shop/basic.html' %}
{% block title %} Tracker - My Awesome Cart {% endblock %}

{% block body %}

<div class="container">
  <div class="col my-4">
    <h2 class="text-center">
      Enter your Order ID and Email Address to Track your Order
    </h2>
    <p class="text-center">
      <i>All Forms marked with '<span style="color: red">*</span>' are
        required.</i>
    </p>
    <form action="#" method="post" id="trackerForm">{% csrf_token %}
      <input type="text" style="display: none;" name="phone" id="phone">
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="OrderID">Order ID <span style="color: red">*</span></label>
          <input type="text" class="form-control" id="OrderID" placeholder="Enter your Order ID Here..." name="OrderID"
            required>
        </div>
        <div class="form-group col-md-6">
          <label for="email">Email <span style="color: red">*</span></label>
          <input type="email" class="form-control" id="email" placeholder="Enter your Email Here..." name="email"
            required>
        </div>
        <div class="text-center" style="align-items: center;">
          <button type="submit" class="btn btn-primary">Track Order</button>
        </div>
    </form>

  </div>
  <div class="col my-2">
    <h2 class="text-center">
      Your Order Status:
    </h2>
    <div class="my-4">
      <ul class="list-group" id="items">
      <span class="text-center"><strong>Enter your Order ID and Email Address to Track your Order</strong></span>
      </ul>
    </div>
  </div>
  </form>

</div>
</div>
{% endblock body%}
{% block js %}
<script>
  $('#trackerForm').submit(function (event) {
    event.preventDefault();
    $('#items').empty();
    var formData = {
      'OrderID': $('input[name=OrderID]').val(),
      'email': $('input[name=email]').val(),
      'csrfmiddlewaretoken': $('input[name=csrfmiddlewaretoken]').val(),
    };
    $.ajax({
        type: 'POST',
        url: '/shop/tracker/',
        data: formData,
        encode: true
      })
      .done(function (data) {
        let updates = JSON.parse(data)
        if (updates.length > 0 & updates != {}) {
          for (let i = 0; i < updates.length; i++) {
            let text = updates[i]['text'];
            let time = updates[i]['time'];
            mystr = `        <li class="list-group-item d-flex justify-content-between align-items-center">
                        ${text}
                          <span class="badge badge-primary badge-pill">${time}</span>
                      </li>`
            $('#items').append(mystr);
          }
        } else {
          mystr = `        <li class="list-group-item d-flex justify-content-between align-items-center">
                        Sorry, We are not able to fetch your order associated with your Order ID and Email. Please check the spelling of the Order ID and Email and try again.
                          
                      </li>`
          $('#items').append(mystr);
        }
      });
  });
</script>
{% endblock js %}